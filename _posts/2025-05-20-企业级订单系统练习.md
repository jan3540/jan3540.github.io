---
layout: mypost
title: ä¼ä¸šçº§è®¢å•ç³»ç»Ÿç»ƒä¹ 
categories: [Mysql]
---

# ç¬¬ä¸€ç¯‡ç»ƒä¹ ï¼šä¼ä¸šçº§è®¢å•ç³»ç»Ÿ

æœ¬ç»ƒä¹ ä»¥ **Enterprise Order System** ä¸ºèƒŒæ™¯ï¼Œåˆ† 9 ä¸ªä»»åŠ¡ï¼Œæ¶µç›– **åº“è¡¨è®¾è®¡**ã€**CRUD**ã€**å¤–é”®çº¦æŸ**ã€**ç´¢å¼•ä¼˜åŒ–**ã€**å¤šè¡¨è”æŸ¥**ã€**DDL è¿›é˜¶** ç­‰æ ¸å¿ƒæ“ä½œã€‚

---

## âœ… åœºæ™¯èƒŒæ™¯

å…¬å¸ç»è¥ä¸€ä¸ªå•†å“é”€å”®å¹³å°ï¼Œæ¶‰åŠå››å¼ æ ¸å¿ƒè¡¨ï¼š  
- `customers`ï¼ˆå®¢æˆ·ï¼‰  
- `products`ï¼ˆå•†å“ï¼‰  
- `employees`ï¼ˆå‘˜å·¥ï¼‰  
- `orders`ï¼ˆè®¢å•ï¼‰  

---

## ğŸ§± ç¬¬ä¸€æ­¥ï¼šæ•°æ®åº“ & è¡¨è®¾è®¡

### ä»»åŠ¡ 1ï¼šåˆ›å»ºæ•°æ®åº“

```sql
-- æ–°å»º enterprise_db å¹¶åˆ‡æ¢
create database enterprise_db charset=utf8mb4;
use enterprise_db;
```

### ä»»åŠ¡ 2ï¼šæŒ‰é¡ºåºåˆ›å»ºè¡¨

```sql
-- customers è¡¨
create table customers (
  customer_id int primary key auto_increment,
  name        varchar(50) not null,
  email       varchar(50) unique,
  signup_date date
) engine=innodb default charset=utf8mb4;

-- products è¡¨
create table products (
  product_id int primary key auto_increment,
  name       varchar(50) not null,
  price      decimal(10,2) not null,
  stock      int not null
) engine=innodb default charset=utf8mb4;

-- employees è¡¨
create table employees (
  employee_id int primary key auto_increment,
  name        varchar(50) not null,
  hire_date   date,
  department  varchar(50)
) engine=innodb default charset=utf8mb4;

-- orders è¡¨ï¼ˆå«å¤–é”®ï¼‰
create table orders (
  order_id    int primary key auto_increment,
  customer_id int not null,
  product_id  int not null,
  employee_id int not null,
  quantity    int not null,
  order_date  date not null,
  foreign key (customer_id)
    references customers(customer_id)
    on delete cascade,
  foreign key (product_id)
    references products(product_id)
    on delete restrict,
  foreign key (employee_id)
    references employees(employee_id)
    on delete set null
) engine=innodb default charset=utf8mb4;
```

**ç‚¹è¯„**

* `on delete cascade`ï¼šåˆ å®¢æˆ·æ—¶è‡ªåŠ¨åˆ é™¤ç›¸å…³è®¢å•
* `on delete restrict`ï¼šç¦æ­¢åˆ æœ‰è®¢å•çš„å•†å“
* `on delete set null`ï¼šåˆ å‘˜å·¥æ—¶ç½®ç©ºè®¢å•ä¸­ `employee_id`

---

## âœï¸ ç¬¬äºŒæ­¥ï¼šæ•°æ®æ“ä½œï¼ˆCRUDï¼‰

### ä»»åŠ¡ 3ï¼šæ’å…¥æ•°æ®

```sql
-- customers
insert into customers(name,email,signup_date) values
  ('alice','alice@example.com','2025-05-10'),
  ('bob','bob@example.com','2025-05-12'),
  ('carol','carol@example.com','2025-05-14');

-- products
insert into products(name,price,stock) values
  ('pen',1.50,100),
  ('notebook',3.00,50),
  ('eraser',0.80,200);

-- employees
insert into employees(name,hire_date,department) values
  ('emp1','2025-01-05','sales'),
  ('emp2','2025-02-10','support'),
  ('emp3','2025-03-15','marketing');

-- ordersï¼ˆæ³¨æ„å¤–é”®ï¼Œæ’å…¥ä¹‹å‰å·²ç»æ’å…¥è¿‡çš„æ•°æ®ï¼‰
insert into orders(customer_id,product_id,employee_id,quantity,order_date) values
  (1,1,1,10,'2025-05-15'),
  (2,2,2,5,'2025-05-16'),
  (3,3,3,20,'2025-05-17');
```

### ä»»åŠ¡ 4ï¼šåŸºç¡€æŸ¥è¯¢

```sql
-- 4.1 æŒ‰ä»·æ ¼é™åºæŸ¥è¯¢æ‰€æœ‰å•†å“
select * from products
order by price desc;

-- 4.2 è”è¡¨æŸ¥è¯¢è®¢å•è¯¦æƒ…
æ–¹æ³•1
æ–¹æ³•1

SELECT
	a.order_id,
	a.order_date,(
	SELECT
		b.NAME 
	FROM
		customers b 
	WHERE
		b.customer_id = a.customer_id 
	) name01,
	( SELECT d.NAME FROM products d WHERE d.product_id = a.product_id ) name002,(
	SELECT
		c.NAME 
	FROM
		employees c 
	WHERE
		c.employee_id = a.employee_id 
	) 
FROM
	orders a


select
  o.order_id,
  c.name   as customer,
  p.name   as product,
  e.name   as employee,
  o.quantity,
  o.order_date
from orders o
inner join customers c on o.customer_id = c.customer_id
inner join products p  on o.product_id  = p.product_id
inner join employees e on o.employee_id = e.employee_id;

-- 4.3 æŸ¥è¯¢è¿‘ 7 å¤©çš„è®¢å•
select * from orders
where order_date >= current_date - interval 7 day;
```

---

## ğŸ”„ ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°ä¸åˆ é™¤

### ä»»åŠ¡ 5ï¼šæ›´æ–°æ“ä½œ

```sql
-- æ›´æ–°æŸå®¢æˆ·é‚®ç®±
update customers
set email = 'alice@new.com'
where customer_id = 1;

-- å•†å“æ¶¨ä»· 10%
update products
set price = price * 1.10
where name = 'pen';

-- å‘˜å·¥è°ƒå²—
update employees
set department = 'hr'
where name = 'emp2';
```

### ä»»åŠ¡ 6ï¼šåˆ é™¤æ“ä½œ

```sql
-- åˆ é™¤ç¦»èŒå‘˜å·¥ï¼ˆéœ€å…ˆå¤„ç† orders.employee_idï¼‰
delete from orders
where employee_id = 3;

delete from employees
where employee_id = 3;

-- åˆ é™¤åº“å­˜ä¸º 0 çš„å•†å“
delete from products
where stock = 0;

-- åˆ é™¤å®¢æˆ·åŠå…¶è®¢å•ï¼ˆcascadeï¼‰
delete from customers
where customer_id = 2;
```

---

## ğŸ›  ç¬¬å››æ­¥ï¼šè¡¨ç»“æ„å˜æ›´ï¼ˆALTER TABLEï¼‰

### ä»»åŠ¡ 7ï¼šç»“æ„è°ƒæ•´

```sql
-- æ–°å¢ vip_level å­—æ®µï¼Œé»˜è®¤ normal
alter table customers
  add column vip_level enum('normal','vip') not null default 'normal';

-- ä¿®æ”¹ price ç²¾åº¦
alter table products
  modify column price decimal(12,2) not null;

-- åˆ é™¤å‘˜å·¥è¡¨ phone åˆ—ï¼ˆå‡è®¾å­˜åœ¨ï¼‰
alter table employees
  drop column phone;
```

---

## âš¡ ç¬¬äº”æ­¥ï¼šç´¢å¼•å®æˆ˜

### ä»»åŠ¡ 8ï¼šåˆ›å»ºç´¢å¼•

```sql
-- å¤åˆç´¢å¼•ï¼š(customer_id, order_date)
create index idx_ord_customer_date
  on orders(customer_id, order_date);
```

```sql
-- å¯¹æ¯” explain analyze
explain analyze
select * from orders
where customer_id = 1
  and order_date = '2025-05-15';
```

**ç‚¹è¯„**

* å¤åˆç´¢å¼•æœ€å·¦å‰ç¼€åŒ¹é…å¯åŠ é€Ÿè”åˆæŸ¥è¯¢
* ä½¿ç”¨ `explain analyze` è§‚å¯Ÿ `index lookup` vs `table scan`

---

## ğŸ¯ ç¬¬å…­æ­¥ï¼šå¤æ‚ç»Ÿè®¡æŸ¥è¯¢

### ä»»åŠ¡ 9ï¼šèšåˆä¸åˆ†ç»„

```sql
-- æ¯ä½å®¢æˆ·çš„è®¢å•æ•°ä¸æ€»æ¶ˆè´¹
select
  c.name,
  count(o.order_id)        as order_count,
  sum(p.price * o.quantity) as total_spent
from customers c
left join orders o  on c.customer_id = o.customer_id
left join products p on o.product_id  = p.product_id
group by c.customer_id, c.name;

-- æ¯ä½å‘˜å·¥è´Ÿè´£çš„è®¢å•æ•° > 1
select
  e.name,
  count(o.order_id) as handled_orders
from employees e
join orders o on e.employee_id = o.employee_id
group by e.employee_id, e.name
having handled_orders > 1;
```

---

> ğŸ‰ **ç»ƒä¹ åˆ°æ­¤ç»“æŸ**ï¼Œæ¶µç›– ä¼ä¸šçº§åº“è¡¨è®¾è®¡ã€CRUDã€å¤–é”®å®Œæ•´æ€§ã€ç´¢å¼•ä¼˜åŒ–ã€å¤šè¡¨ç»Ÿè®¡ã€DDL è¿›é˜¶ç­‰æ ¸å¿ƒæŠ€èƒ½ã€‚
> å»ºè®®ï¼šæ¯æ‰§è¡Œä¸€æ­¥éƒ½ä½¿ç”¨ `desc` / `select` / `explain analyze` éªŒè¯æ•ˆæœï¼ŒåŠ æ·±ç†è§£ã€‚

```
```xxxxxxxxxxÂ -- æ–°å»º enterprise_db å¹¶åˆ‡æ¢create database enterprise_db charset=utf8mb4;use enterprise_db;sql

---

<p align="right">ä½œäº2025å¹´5æœˆ20æ—¥</p>